<div class="app-shell">
	<header class="app-header">
		<div class="brand">
			<p class="eyebrow">Storium</p>
			<h1>Unified Drive Explorer</h1>
			<p class="tagline">Manage space across all your Google accounts in one place.</p>
		</div>
		<div class="header-actions">
			<a class="btn primary" [href]="connectUrl">Connect Google account</a>
			<button class="btn ghost" type="button" (click)="refresh()">Refresh</button>
		</div>
	</header>

	<div class="status" *ngIf="statusMessage">
		{{ statusMessage }}
	</div>

	<section class="main-grid">
		<section class="panel accounts-panel">
			<div class="panel-header">
				<h2>Linked accounts</h2>
				<p>Tap an account to browse its files.</p>
			</div>

			<ng-container *ngIf="accounts$ | async as accounts">
				<div class="empty" *ngIf="!accounts.length">
					<p>No accounts linked yet.</p>
					<p>Connect at least two Google accounts to move files.</p>
				</div>

				<div class="account-list" *ngIf="accounts.length">
					<div class="account-item" *ngFor="let account of accounts">
						<button
							class="account-card"
							type="button"
							[class.active]="account.id === activeAccountId"
							(click)="setActiveAccount(account.id)"
						>
							<div>
								<p class="account-name">{{ account.displayName || account.email }}</p>
								<p class="account-email">{{ account.email }}</p>
							</div>
							<div class="account-meta" *ngIf="account.usage?.storageQuota">
								<p>{{ formatBytes(account.usage.storageQuota?.usage) }} used</p>
								<p>{{ formatBytes(account.usage.storageQuota?.limit) }} total</p>
							</div>
							<span class="account-chip">Drive</span>
						</button>
						<button
							class="btn text"
							type="button"
							(click)="removeAccount(account.id)"
						>
							Remove
						</button>
					</div>
				</div>

				<div class="target-select" *ngIf="accounts.length">
					<label for="target">Target account</label>
					<select
						id="target"
						[value]="targetAccountId || ''"
						(change)="setTargetAccount($any($event.target).value || null)"
					>
						<option value="">Select account</option>
						<option *ngFor="let account of accounts" [value]="account.id">
							{{ account.displayName || account.email }}
						</option>
					</select>
				</div>
			</ng-container>
		</section>

		<section class="panel files-panel">
			<div class="panel-header">
				<h2>Files</h2>
				<p *ngIf="!activeAccountId">Pick an account to explore.</p>
				<p *ngIf="activeAccountId">Showing files in the selected account.</p>
			</div>

			<div class="transfer-status" *ngIf="transferStatus">
				{{ transferStatus }}
			</div>

			<ng-container *ngIf="files$ | async as files">
				<div class="empty" *ngIf="!files?.files?.length">
					<p>No files found in the root folder.</p>
				</div>

				<div class="file-list" *ngIf="files?.files?.length">
					<div class="file-row" *ngFor="let file of files.files">
						<div>
							<p class="file-name">{{ file.name }}</p>
							<p class="file-meta">{{ file.mimeType }}</p>
						</div>
						<div class="file-actions">
							<button
								class="btn ghost"
								type="button"
								(click)="transferFile(file.id, 'copy')"
								[disabled]="!targetAccountId || targetAccountId === activeAccountId"
							>
								Copy
							</button>
							<button
								class="btn danger"
								type="button"
								(click)="transferFile(file.id, 'move')"
								[disabled]="!targetAccountId || targetAccountId === activeAccountId"
							>
								Move
							</button>
						</div>
					</div>
				</div>
			</ng-container>
		</section>
	</section>
</div>